@namespace NTComponents
@using Microsoft.AspNetCore.Components.Forms

<div class="tnt-input-container nt-input-file-container" style="@ElementStyle">
	<label class="@ElementClass" title="@ElementTitle" lang="@ElementLang" id="@ElementId">
		@if (StartIcon is not null) {
			@StartIcon.Render("tnt-start-icon")
		}

		@if (RendererInfo.IsInteractive) {
			<InputFile OnChange="OnFilesSelectedAsync" @attributes="InputAttributes" />
		}
		else {
			<input type="file" @attributes="StaticInputAttributes" />
		}

		@if (!string.IsNullOrWhiteSpace(Label)) {
			<span class="tnt-label">@Label</span>
		}

		@if (ShowUploadButton && RendererInfo.IsInteractive) {
			<span class="nt-input-file-upload-button" @onclick:preventDefault="true" @onclick:stopPropagation="true">
				<TnTButton Appearance="@UploadButtonAppearance"
						   ButtonSize="@EffectiveUploadButtonSize"
						   Type="ButtonType.Button"
						   Disabled="@UploadButtonDisabled"
						   BackgroundColor="@EffectiveUploadButtonBackgroundColor"
						   TextColor="@EffectiveUploadButtonTextColor"
						   OnClickCallback="OnUploadButtonClickedAsync">
					<span>@UploadButtonText</span>
				</TnTButton>
			</span>
		}

		@if (EndIcon is not null) {
			@EndIcon.Render("tnt-end-icon")
		}

		@if (ShowProgress && _fileProgressStates.Count > 0) {
			<span class="tnt-input-progress">
				<div class="nt-input-file-progress-list">
					@foreach (var fileState in _fileProgressStates.OrderBy(i => i.Index)) {
						<div class="nt-input-file-progress-item">
							<div class="nt-input-file-progress-title">@fileState.Name</div>
							<div class="nt-input-file-progress-subtitle">@fileState.Status</div>
							<TnTProgressIndicator Appearance="ProgressAppearance.Linear"
												  Value="@(fileState.IsIndeterminate ? null : fileState.Percentage)"
												  Max="100"
												  min="0" />
						</div>
					}
				</div>
			</span>
		}
	</label>

	@if (Tooltip is not null) {
		@TooltipIcon.Render()
	}

	@if (!string.IsNullOrWhiteSpace(SupportingText)) {
		<span class="tnt-supporting-text">@SupportingText</span>
	}
</div>
